{"version":3,"sources":["webpack:///./src/views/user-manage/components/Export2Excel.vue","webpack:///./src/views/user-manage/components/Export2Excel.vue?bbfc","webpack:///./src/views/user-manage/index.vue","webpack:///./src/views/user-manage/index.vue?c74c","webpack:///./src/api/getUser.js","webpack:///./src/views/user-manage/index.vue?f05c"],"names":["i18n","useI18n","excelName","ref","exportDefaultName","t","value","watchSwitchLang","loading","USER_RELATIONS","姓名","联系方式","角色","formatJson","headers","rows","map","item","Object","keys","key","roles","JSON","stringify","title","onConfirm","getAllUser","data","console","log","excel","export_json_to_excel","header","filename","autoWidth","bookType","closed","emits","__exports__","router","useRouter","tableData","total","page","size","exportToExcelVisible","getListData","getUserList","result","handleSizeChange","currentSize","handleCurrentChange","currentPage","onImportExcelClick","push","onActivated","deleteUserClick","row","deleteUser","code","ElMessage","success","onToExcelClick","onShowClick","id","request","url","params","method","getUserDetail","getRolesList"],"mappings":"2YAmCMA,EAAOC,uBACPC,EAAYC,iBAAI,IAElBC,EAAoBJ,EAAKK,EAAE,yBAC/BH,EAAUI,MAAQF,EAElBG,gBAAgB,WACdH,EAAoBJ,EAAKK,EAAE,yBAC3BH,EAAUI,MAAQF,KAMpB,IAAMI,EAAUL,kBAAI,GACdM,EAAiB,CACrBC,KAAI,WACJC,OAAM,SACNC,KAAI,SAIAC,EAAa,SAACC,EAASC,GAG3B,OAAOA,EAAKC,KAAI,SAACC,GACf,OAAOC,OAAOC,KAAKL,GAASE,KAAI,SAACI,GAE/B,GAAqB,UAAjBN,EAAQM,GAAkB,CAC5B,IAAMC,EAAQJ,EAAKH,EAAQM,IAC3B,OAAOE,KAAKC,UAAUF,EAAML,KAAI,SAACQ,GAAD,OAAWA,EAAMA,UAEnD,OAAOP,EAAKH,EAAQM,WAIpBK,EAAS,yDAAG,+GAChBjB,EAAQF,OAAQ,EADA,SAEKoB,iBAFL,uBAEVC,EAFU,EAEVA,KACNA,EAAOd,EAAWJ,EAAgBkB,EAAKA,MACvCC,QAAQC,IAAIF,GAJI,SAKI,qFALJ,OAKVG,EALU,OAMhBA,EAAMC,qBAAqB,CAEzBC,OAAQd,OAAOC,KAAKV,GAEpBkB,OAEAM,SAAU/B,EAAUI,OAASF,EAE7B8B,WAAW,EAEXC,SAAU,SAEZC,IAlBgB,4CAAH,qDAwBTA,EAAS,WACb5B,EAAQF,OAAQ,EAChB+B,EAAM,qBAAqB,I,ikCC9F7B,MAAMC,EAAc,EAEL,Q,yFCiGf,IAAMC,EAASC,iBACTxC,EAAOC,uBAEPwC,EAAYtC,iBAAI,IAChBuC,EAAQvC,iBAAI,GACZwC,EAAOxC,iBAAI,GACXyC,EAAOzC,iBAAI,GACX0C,EAAuB1C,kBAAI,GAG3B2C,EAAW,yDAAG,sHACKC,eAAY,CACjCJ,KAAMA,EAAKrC,MACXsC,KAAMA,EAAKtC,QAHK,gBACVqB,EADU,EACVA,KAIRc,EAAUnC,MAAQqB,EAAKqB,OACvBN,EAAMpC,MAAQqB,EAAKe,MAND,2CAAH,qDAQjBI,IAGAvC,eAAgBuC,GAIhB,IAAMG,EAAmB,SAACC,GACxBtB,QAAQC,IAAIqB,GACZN,EAAKtC,MAAQ4C,EACbJ,KAMIK,EAAsB,SAACC,GAC3BT,EAAKrC,MAAQ8C,EACbN,KAIIO,EAAqB,WACzBd,EAAOe,KAAK,iBAEdC,yBAAYT,GAGZ,IAAMU,EAAe,yDAAG,WAAOC,GAAP,yGACDC,eAAWD,GADV,gBAChB9B,EADgB,EAChBA,KACY,IAAdA,EAAKgC,OACPC,OAAUC,QAAQ7D,EAAKK,EAAE,4BACzByC,KAJoB,2CAAH,sDASfgB,EAAiB,WACrBjB,EAAqBvC,OAAQ,GAIzByD,EAAc,SAACC,GACnBzB,EAAOe,KAAP,qBAA0BU,K,6nIC7J5B,MAAM,EAA2B,IAAgB,EAAQ,CAAC,CAAC,YAAY,qBAExD,gB,2DCRf,0LAEajB,EAAc,SAACpB,GAC1B,OAAOsC,eAAQ,CACbC,IAAK,iBACLC,OAAQxC,KAIC+B,EAAa,SAAC/B,GACzB,OAAOsC,eAAQ,CACbC,IAAK,mBACLE,OAAQ,OACRzC,UAISD,EAAa,WACxB,OAAOuC,eAAQ,CACbC,IAAK,uBAGIG,EAAgB,SAAC1C,GAC5B,OAAOsC,eAAQ,CACbG,OAAQ,OACRF,IAAK,sBACLvC,UAGS2C,EAAe,WAC1B,OAAOL,eAAQ,CACbC,IAAK,sB,kCC/BT","file":"js/chunk-4d5744d6.d940c8c3.js","sourcesContent":["<template>\r\n  <el-dialog\r\n    :title=\"$t('msg.excel.title')\"\r\n    :model-value=\"modelValue\"\r\n    @close=\"closed\"\r\n    width=\"30%\"\r\n  >\r\n    <el-input\r\n      :placeholder=\"$t('msg.excel.placeholder')\"\r\n      v-model=\"excelName\"\r\n    ></el-input>\r\n    <template #footer>\r\n      <span class=\"dialog-footer\">\r\n        <el-button @click=\"closed\">{{ $t('msg.excel.close') }}</el-button>\r\n        <el-button type=\"primary\" @click=\"onConfirm\" :loading=\"loading\">{{\r\n          $t('msg.excel.confirm')\r\n        }}</el-button>\r\n      </span>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { getAllUser } from '@/api/getUser'\r\nimport { watchSwitchLang } from '@/utils/i18n'\r\n\r\ndefineProps({\r\n  modelValue: {\r\n    type: Boolean,\r\n    required: true\r\n  }\r\n})\r\n\r\nconst i18n = useI18n()\r\nconst excelName = ref('')\r\nconst emits = defineEmits(['update:modelValue'])\r\nlet exportDefaultName = i18n.t('msg.excel.defaultName')\r\nexcelName.value = exportDefaultName\r\n\r\nwatchSwitchLang(() => {\r\n  exportDefaultName = i18n.t('msg.excel.defaultName')\r\n  excelName.value = exportDefaultName\r\n})\r\n\r\n/**\r\n * 导出按钮点击事件\r\n */\r\nconst loading = ref(false)\r\nconst USER_RELATIONS = {\r\n  姓名: 'username',\r\n  联系方式: 'mobile',\r\n  角色: 'title'\r\n}\r\n\r\n// 该方法负责将数组转化成二维数组\r\nconst formatJson = (headers, rows) => {\r\n  // 首先遍历数组\r\n  // [{ username: '张三'},{},{}]  => [[’张三'],[],[]]\r\n  return rows.map((item) => {\r\n    return Object.keys(headers).map((key) => {\r\n      // 角色特殊处理\r\n      if (headers[key] === 'title') {\r\n        const roles = item[headers[key]]\r\n        return JSON.stringify(roles.map((title) => title.title))\r\n      }\r\n      return item[headers[key]]\r\n    })\r\n  })\r\n}\r\nconst onConfirm = async () => {\r\n  loading.value = true\r\n  let { data } = await getAllUser()\r\n  data = formatJson(USER_RELATIONS, data.data)\r\n  console.log(data)\r\n  const excel = await import('@/utils/Export2Excel')\r\n  excel.export_json_to_excel({\r\n    // excel 表头\r\n    header: Object.keys(USER_RELATIONS),\r\n    // excel 数据（二维数组结构）\r\n    data,\r\n    // 文件名称\r\n    filename: excelName.value || exportDefaultName,\r\n    // 是否自动列宽\r\n    autoWidth: true,\r\n    // 文件类型\r\n    bookType: 'xlsx'\r\n  })\r\n  closed()\r\n}\r\n\r\n/**\r\n * 关闭\r\n */\r\nconst closed = () => {\r\n  loading.value = false\r\n  emits('update:modelValue', false)\r\n}\r\n</script>\r\n","import script from \"./Export2Excel.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Export2Excel.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\n  <div class=\"user-manage-container\">\n    <el-card class=\"header\">\n      <div>\n        <el-button\n          type=\"primary\"\n          @click=\"onImportExcelClick\"\n          v-permission=\"['importUser']\"\n        >\n          {{ $t('msg.excel.importExcel') }}</el-button\n        >\n        <el-button type=\"success\" @click=\"onToExcelClick\">\n          {{ $t('msg.excel.exportExcel') }}\n        </el-button>\n      </div>\n    </el-card>\n    <el-card>\n      <el-table :data=\"tableData\" border style=\"width: 100%\">\n        <el-table-column label=\"#\" type=\"index\" />\n        <el-table-column prop=\"username\" :label=\"$t('msg.excel.name')\">\n        </el-table-column>\n        <el-table-column prop=\"mobile\" :label=\"$t('msg.excel.mobile')\">\n        </el-table-column>\n        <el-table-column :label=\"$t('msg.excel.avatar')\" align=\"center\">\n          <template v-slot=\"{ row }\">\n            <el-image\n              class=\"avatar\"\n              :src=\"row.photo\"\n              :preview-src-list=\"[row.avatar]\"\n            ></el-image>\n          </template>\n        </el-table-column>\n        <el-table-column :label=\"$t('msg.excel.role')\">\n          <template #default=\"{ row }\">\n            <div\n              v-if=\"row.title\"\n              v-for=\"(item, index) in row.title\"\n              :key=\"index\"\n            >\n              <el-tag size=\"small\">{{ item.title }}</el-tag>\n            </div>\n            <div v-else>\n              <el-tag size=\"small\">{{ $t('msg.excel.defaultRole') }}</el-tag>\n            </div>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"openTime\" :label=\"$t('msg.excel.openTime')\">\n        </el-table-column>\n        <el-table-column\n          :label=\"$t('msg.excel.action')\"\n          fixed=\"right\"\n          width=\"260\"\n        >\n          <!-- 作用域 插槽 -->\n          <template #default=\"{ row }\">\n            <el-button\n              type=\"primary\"\n              size=\"small\"\n              @click=\"onShowClick(row._id)\"\n              >{{ $t('msg.excel.show') }}</el-button\n            >\n            <el-button\n              type=\"info\"\n              size=\"small\"\n              v-permission=\"['distributeRole']\"\n              >{{ $t('msg.excel.showRole') }}</el-button\n            >\n            <el-button\n              type=\"danger\"\n              size=\"small\"\n              @click=\"deleteUserClick(row)\"\n              v-permission=\"['removeUser']\"\n              >{{ $t('msg.excel.remove') }}</el-button\n            >\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <el-pagination\n        class=\"pagination\"\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"page\"\n        :page-sizes=\"[2, 5, 10, 20]\"\n        :page-size=\"size\"\n        layout=\"total, sizes, prev, pager, next, jumper\"\n        :total=\"total\"\n      >\n      </el-pagination>\n    </el-card>\n    <export-excel v-model=\"exportToExcelVisible\"></export-excel>\n  </div>\n</template>\n\n<script setup>\nimport ExportExcel from './components/Export2Excel.vue'\nimport { ref, onActivated } from 'vue'\nimport { getUserList, deleteUser } from '@/api/getUser'\nimport { watchSwitchLang } from '@/utils/i18n'\nimport { useRouter } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport { useI18n } from 'vue-i18n'\nconst router = useRouter()\nconst i18n = useI18n()\n// 数据相关\nconst tableData = ref([])\nconst total = ref(0)\nconst page = ref(1)\nconst size = ref(2)\nconst exportToExcelVisible = ref(false)\n\n// 获取数据的方法\nconst getListData = async () => {\n  const { data } = await getUserList({\n    page: page.value,\n    size: size.value\n  })\n  tableData.value = data.result\n  total.value = data.total\n}\ngetListData()\n\n// 监听语言切换\nwatchSwitchLang(getListData)\n/**\n * size 改变触发\n */\nconst handleSizeChange = (currentSize) => {\n  console.log(currentSize)\n  size.value = currentSize\n  getListData()\n}\n\n/**\n * 页码改变触发\n */\nconst handleCurrentChange = (currentPage) => {\n  page.value = currentPage\n  getListData()\n}\n\n//导入 excel\nconst onImportExcelClick = () => {\n  router.push('/user/import')\n}\nonActivated(getListData)\n\n//删除用户\nconst deleteUserClick = async (row) => {\n  let { data } = await deleteUser(row)\n  if (data.code === 0) {\n    ElMessage.success(i18n.t('msg.excel.removeSuccess'))\n    getListData()\n  }\n}\n\n// 导出\nconst onToExcelClick = () => {\n  exportToExcelVisible.value = true\n}\n\n// 查看按钮点击事件\nconst onShowClick = (id) => {\n  router.push(`/user/info/${id}`)\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.user-manage-container {\n  .header {\n    margin-bottom: 22px;\n    text-align: right;\n  }\n  :deep(.avatar) {\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n  }\n\n  :deep(.el-tag) {\n    margin-right: 6px;\n  }\n\n  .pagination {\n    margin-top: 20px;\n    text-align: center;\n  }\n}\n</style>\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=a8e328e4&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\朱雀\\\\Desktop\\\\vue\\\\vue3-cms\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-a8e328e4\"]])\n\nexport default __exports__","import request from '@/utils/request'\r\n\r\nexport const getUserList = (data) => {\r\n  return request({\r\n    url: '/user/userList',\r\n    params: data\r\n  })\r\n}\r\n\r\nexport const deleteUser = (data) => {\r\n  return request({\r\n    url: '/user/deleteUser',\r\n    method: 'post',\r\n    data\r\n  })\r\n}\r\n\r\nexport const getAllUser = () => {\r\n  return request({\r\n    url: '/user/allUserList',\r\n  })\r\n}\r\nexport const getUserDetail = (data) => {\r\n  return request({\r\n    method: 'post',\r\n    url: '/user/getUserDetail',\r\n    data\r\n  })\r\n}\r\nexport const getRolesList = () => {\r\n  return request({\r\n    url: '/user/rolesList',\r\n\r\n  })\r\n}\r\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=a8e328e4&lang=scss&scoped=true\""],"sourceRoot":""}